class Dice
  attr_accessor :client
  def on_message(sender, content, event)
    return if sender['name'] == 'bot'
    case content
    when /(\d+)[dD](\d+)(?:\+(\d+))?/
      results = Array.new($1.to_i){ 1+rand($2.to_i) }
      total = results.inject { |t,v| t + v }
      total += $3.to_i if $3
      client.send_message "#{total} from #{results.inspect} #{"+#{$3}" if $3}"
    end
  end
end

use Dice.new